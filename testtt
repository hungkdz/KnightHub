-- ğŸ›  Khai bÃ¡o dá»‹ch vá»¥
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")

-- ğŸƒâ€â™‚ï¸ Khai bÃ¡o nhÃ¢n váº­t ngÆ°á»i chÆ¡i
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- ğŸ”„ HÃ m cáº­p nháº­t khi nhÃ¢n váº­t respawn
local function onCharacterAdded(char)
    character = char
    humanoidRootPart = character:WaitForChild("HumanoidRootPart")
end
player.CharacterAdded:Connect(onCharacterAdded)

-- ğŸ² HÃ m táº¡o má»™t Ä‘iá»ƒm gom quÃ¡i ngáº«u nhiÃªn trong pháº¡m vi 125
local function getRandomGatherPosition()
    local randomOffsetX = math.random(-125, 125)
    local randomOffsetZ = math.random(-125, 125)
    local heightOffset = 10  -- Äá»™ cao cá»§a nhÃ¢n váº­t Ä‘á»ƒ trÃ¡nh bá»‹ táº¥n cÃ´ng
    return humanoidRootPart.Position + Vector3.new(randomOffsetX, 0, randomOffsetZ), heightOffset
end

-- ğŸ” HÃ m láº¥y danh sÃ¡ch táº¥t cáº£ quÃ¡i trong pháº¡m vi
local function getNearbyEnemies(range)
    local enemies = {}

    if not humanoidRootPart then return enemies end

    for _, enemy in pairs(Workspace.Enemies:GetChildren()) do
        if enemy:IsA("Model") and enemy:FindFirstChild("HumanoidRootPart") and enemy:FindFirstChildOfClass("Humanoid") then
            local enemyRoot = enemy:FindFirstChild("HumanoidRootPart")
            local enemyHumanoid = enemy:FindFirstChildOfClass("Humanoid")

            -- Kiá»ƒm tra quÃ¡i cÃ²n sá»‘ng khÃ´ng
            if enemyHumanoid.Health > 0 then
                local distance = (enemyRoot.Position - humanoidRootPart.Position).Magnitude

                -- Chá»‰ thÃªm quÃ¡i náº¿u trong pháº¡m vi
                if distance <= range then
                    table.insert(enemies, enemy)
                end
            end
        end
    end

    return enemies
end

-- ğŸš€ HÃ m dÃ¹ng Tween Ä‘á»ƒ di chuyá»ƒn quÃ¡i Ä‘áº¿n Ä‘iá»ƒm golocal TweenService = game:GetService("TweenService")
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- ğŸ”¥ Giá»¯ nhÃ¢n váº­t trÃªn khÃ´ng báº±ng BodyVelocity
local function ApplyFlight()
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.Parent = humanoidRootPart

    -- ğŸ” Duy trÃ¬ trÃªn khÃ´ng
    task.spawn(function()
        while task.wait() do
            bodyVelocity.Velocity = Vector3.new(0, 0, 0)
        end
    end)
end

ApplyFlight()

-- ğŸŒ€ Gom quÃ¡i liÃªn tá»¥c tween vá» Ä‘Ãºng vá»‹ trÃ­
local function GatherMobs(targetPosition)
    local gathered = 0
    for _, mob in pairs(game.Workspace.Enemies:GetChildren()) do
        if gathered >= 3 then break end -- ğŸ”¥ Giá»›i háº¡n 3 quÃ¡i
        if mob.Name == TargetMob and mob:FindFirstChild("HumanoidRootPart") then
            local targetCFrame = CFrame.new(targetPosition.X, mob.HumanoidRootPart.Position.Y, targetPosition.Z)

            -- ğŸ”¥ LiÃªn tá»¥c tween quÃ¡i vá» Ä‘Ãºng vá»‹ trÃ­
            task.spawn(function()
                while mob.Parent and mob:FindFirstChild("HumanoidRootPart") do
                    local tween = TweenService:Create(
                        mob.HumanoidRootPart,
                        TweenInfo.new(0.2, Enum.EasingStyle.Linear, Enum.EasingDirection.Out),
                        {CFrame = targetCFrame}
                    )
                    tween:Play()
                    task.wait(0.2)
                end
            end)

            gathered = gathered + 1
        end
    end
end

-- ğŸ”¥ Kiá»ƒm tra náº¿u táº¥t cáº£ quÃ¡i Ä‘Ã£ cháº¿t
local function AllMobsDead()
    for _, mob in pairs(game.Workspace.Enemies:GetChildren()) do
        if mob.Name == TargetMob then
            return false
        end
    end
    return true
end

-- ğŸ“ Di chuyá»ƒn qua tá»«ng Ä‘iá»ƒm trong CFT
local function MoveThroughPoints()
    for _, targetCFrame in ipairs(TargetCFT) do
        TweenToPosition(targetCFrame, 120) -- ğŸ”¥ Tween vá»›i tá»‘c Ä‘á»™ 50
        task.wait(1)
        GatherMobs(targetCFrame.Position)

        while not AllMobsDead() do
            task.wait(0.5)
        end
    end
end

-- ğŸ¯ Báº¯t Ä‘áº§u farm
local function StartFarming()
    local level = player.Data.Level.Value
    local NameQuest, LevelQ, CFT, CFQ, Ms = GetQuestInfo(level)

    TargetQuest = NameQuest
    TargetQuestLevel = LevelQ
    TargetCFT = CFT
    TargetCFQ = CFQ
    TargetMob = Ms

    MoveThroughPoints()
end

StartFarming()
