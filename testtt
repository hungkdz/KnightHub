local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local player = game.Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- ğŸ”¥ Giá»¯ nhÃ¢n váº­t trÃªn khÃ´ng báº±ng BodyVelocity
local function ApplyFlight()
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.Parent = humanoidRootPart

    -- ğŸ” Duy trÃ¬ trÃªn khÃ´ng
    task.spawn(function()
        while task.wait() do
            bodyVelocity.Velocity = Vector3.new(0, 0, 0)
        end
    end)
end

ApplyFlight()

-- ğŸ¯ HÃ m láº¥y thÃ´ng tin nhiá»‡m vá»¥ (sáº¯p xáº¿p láº¡i nhÆ° trÆ°á»›c)
local function GetQuestInfo(level)
    local NameQuest, LevelQ, CFT, CFQ, Ms

    if level >= 1 and level <= 9 then
        NameQuest = "BanditQuest1"
        LevelQ = 1
        CFT = {CFrame.new(943, 40, 1562), CFrame.new(1115, 40, 1619), CFrame.new(1265.79199, 40, 1592.849)}
        CFQ = CFrame.new(1050, 16, 1540)
        Ms = "Bandit"
    elseif level >= 10 and level <= 14 then
        NameQuest = "JungleQuest"
        LevelQ = 1
        CFT = {CFrame.new(-1673.04834, 30, -73.7299271), CFrame.new(-1570.29041, 30, 339.327484), CFrame.new(-1552.57837, 30, 22.7689781)}
        CFQ = CFrame.new(-1600, 36, 150)
        Ms = "Monkey"
    elseif level >= 15 and level <= 29 then
        NameQuest = "JungleQuest"
        LevelQ = 2
        CFT = {CFrame.new(-1281.31323, 20, -509.142456), CFrame.new(-1216.53259, 20, -586.503235)}
        CFQ = CFrame.new(-1600, 36, 150)
        Ms = "Gorilla"
    elseif level >= 30 and level <= 39 then
        NameQuest = "BuggyQuest1"
        LevelQ = 1
        CFT = {CFrame.new(-1160.14258, 18, 3929.40723), CFrame.new(-1264.62415, 18, 3903.80957), CFrame.new(-943.844299, 30, 3973.2478)}
        CFQ = CFrame.new(-1130, 4, 3820)
        Ms = "Pirate"
    elseif level >= 40 and level <= 59 then
        NameQuest = "BuggyQuest1"
        LevelQ = 2
        CFT = {CFrame.new(-1204.29492, 30, 4286.92773), CFrame.new(-962.269287, 30, 4312.79834), CFrame.new(-1333.89319, 30, 4227.29639)}
        CFQ = CFrame.new(-1140.176, 4.752, 3827.405)
        Ms = "Brute"
    end

    return NameQuest, LevelQ, CFT, CFQ, Ms
end

-- ğŸŒŸ HÃ m Tween vá»›i tá»‘c Ä‘á»™ thay vÃ¬ thá»i gian cá»‘ Ä‘á»‹nh
local function TweenToPosition(targetCFrame, speed)
    local distance = (humanoidRootPart.Position - targetCFrame.Position).Magnitude
    local duration = distance / speed

    local tween = TweenService:Create(
        humanoidRootPart,
        TweenInfo.new(duration, Enum.EasingStyle.Linear, Enum.EasingDirection.Out),
        {CFrame = targetCFrame}
    )
    tween:Play()
    tween.Completed:Wait()
end

-- ğŸŒ€ Gom quÃ¡i vÃ o táº¥t cáº£ vá»‹ trÃ­ trong CFT
local function GatherMobs(targetPosition)
    local gathered = 0
    for _, mob in pairs(game.Workspace.Enemies:GetChildren()) do
        if gathered >= 3 then break end -- ğŸ”¥ Giá»›i háº¡n 3 quÃ¡i
        if mob.Name == TargetMob and mob:FindFirstChild("HumanoidRootPart") then
            local targetCFrame = CFrame.new(targetPosition.X, mob.HumanoidRootPart.Position.Y, targetPosition.Z)

            -- ğŸ”¥ ThÃªm BodyVelocity Ä‘á»ƒ giá»¯ quÃ¡i yÃªn vá»‹
            local bodyVelocity = Instance.new("BodyVelocity")
            bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            bodyVelocity.Velocity = Vector3.new(0, 0, 0)
            bodyVelocity.Parent = mob.HumanoidRootPart

            local tween = TweenService:Create(
                mob.HumanoidRootPart,
                TweenInfo.new(0.3, Enum.EasingStyle.Linear, Enum.EasingDirection.Out),
                {CFrame = targetCFrame}
            )
            tween:Play()
            tween.Completed:Wait()
            gathered = gathered + 1
        end
    end
end

-- ğŸ”¥ Kiá»ƒm tra náº¿u táº¥t cáº£ quÃ¡i Ä‘Ã£ cháº¿t
local function AllMobsDead()
    for _, mob in pairs(game.Workspace.Enemies:GetChildren()) do
        if mob.Name == TargetMob then
            return false
        end
    end
    return true
end

-- ğŸ”¥ Náº¿u quÃ¡i bá»‹ lá»—i khÃ´ng gÃ¢y sÃ¡t thÆ°Æ¡ng, bá» qua vÃ  chuyá»ƒn Ä‘iá»ƒm khÃ¡c
local function CheckBuggedMobs()
    local startHealth = {}
    
    -- Ghi nháº­n mÃ¡u ban Ä‘áº§u cá»§a quÃ¡i
    for _, mob in pairs(game.Workspace.Enemies:GetChildren()) do
        if mob.Name == TargetMob and mob:FindFirstChild("Humanoid") then
            startHealth[mob] = mob.Humanoid.Health
        end
    end

    -- Äá»£i trong 3 giÃ¢y
    task.wait(3)

    -- Náº¿u cÃ³ quÃ¡i khÃ´ng bá»‹ giáº£m mÃ¡u => bá» qua vÃ  di chuyá»ƒn
    for mob, health in pairs(startHealth) do
        if mob.Parent and mob:FindFirstChild("Humanoid") and mob.Humanoid.Health == health then
            return true
        end
    end
    return false
end

-- ğŸ“ Di chuyá»ƒn qua tá»«ng Ä‘iá»ƒm trong CFT
local function MoveThroughPoints()
    for _, targetCFrame in ipairs(TargetCFT) do
        TweenToPosition(targetCFrame, 50) -- ğŸ”¥ Tween vá»›i tá»‘c Ä‘á»™ 50
        task.wait(1)
        GatherMobs(targetCFrame.Position)

        -- ğŸ” Kiá»ƒm tra quÃ¡i bá»‹ lá»—i, náº¿u cÃ³ thÃ¬ bá» qua vá»‹ trÃ­ nÃ y
        if CheckBuggedMobs() then
            continue
        end

        while not AllMobsDead() do
            task.wait(0.5)
        end
    end
end

-- ğŸ¯ Láº¥y thÃ´ng tin nhiá»‡m vá»¥ vÃ  báº¯t Ä‘áº§u farm
local function StartFarming()
    local level = player.Data.Level.Value
    local NameQuest, LevelQ, CFT, CFQ, Ms = GetQuestInfo(level)

    TargetQuest = NameQuest
    TargetQuestLevel = LevelQ
    TargetCFT = CFT
    TargetCFQ = CFQ
    TargetMob = Ms

    MoveThroughPoints()
end

StartFarming()
