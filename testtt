local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local rootPart = character:WaitForChild("HumanoidRootPart")

local CFT_Positions = { -- Danh sách vị trí gom quái
    Vector3.new(100, 10, 200),
    Vector3.new(300, 10, 400),
    Vector3.new(500, 10, 600),
}

function GetNearestCFTPosition(position)
    local nearestPos = nil
    local nearestDist = math.huge

    for _, cftPos in ipairs(CFT_Positions) do
        local dist = (Vector3.new(cftPos.X, position.Y, cftPos.Z) - position).Magnitude
        if dist < nearestDist then
            nearestDist = dist
            nearestPos = cftPos
        end
    end

    return nearestPos
end

function GatherEnemies()
    local enemies = {}
    for _, enemy in pairs(workspace.Enemies:GetChildren()) do
        if enemy:FindFirstChild("HumanoidRootPart") and enemy:FindFirstChild("Humanoid") then
            local distance = (enemy.HumanoidRootPart.Position - rootPart.Position).Magnitude
            if distance <= 125 then
                table.insert(enemies, enemy)
            end
        end
    end

    if #enemies == 0 then return end

    local gatherPoint = GetNearestCFTPosition(rootPart.Position)
    if not gatherPoint then return end

    -- Tween nhân vật lên trên điểm gom quái
    local targetPos = gatherPoint + Vector3.new(0, 50, 0)
    local tweenInfo = TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local tween = TweenService:Create(rootPart, tweenInfo, {Position = targetPos})
    tween:Play()
    tween.Completed:Wait()

    -- Gom quái vào điểm đã chọn
    for _, enemy in pairs(enemies) do
        if enemy:FindFirstChild("HumanoidRootPart") then
            local enemyPos = Vector3.new(gatherPoint.X, enemy.HumanoidRootPart.Position.Y, gatherPoint.Z)
            local enemyTween = TweenService:Create(enemy.HumanoidRootPart, tweenInfo, {Position = enemyPos})
            enemyTween:Play()
        end
    end

    task.wait(1) -- Chờ quái di chuyển xong

    -- Cố định quái tại vị trí gom
    for _, enemy in pairs(enemies) do
        if enemy:FindFirstChild("HumanoidRootPart") then
            enemy.HumanoidRootPart.Anchored = true
        end
    end
end
