-- üñ• Load Fluent UI
local Library = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveData = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()

if not Library then
    warn("Fluent UI kh√¥ng t·∫£i ƒë∆∞·ª£c!")
    return
end

local Window = Library:CreateWindow({
    Title = "Knight Hub",
    SubTitle = "By HungK",
    TabWidth = 160,
    Size = UDim2.fromOffset(480, 370),
    Acrylic = true,
    Theme = "Dark"
})

local Tabs = {
    Main = Window:AddTab({ Title = "Main Farm" })
}

-- üéõÔ∏è Th√™m Toggle Auto Quest
local ToggleQuest = Tabs.Main:AddToggle("AutoQuest", { Title = "Auto Quest", Default = false })
_G.AutoQuest = false  

ToggleQuest:OnChanged(function()
    _G.AutoQuest = ToggleQuest.Value  
    if _G.AutoQuest then
        while _G.AutoQuest do
            GetQuest()
            task.wait(5)  
        end
    end
end)

-- üéõÔ∏è Th√™m Toggle Auto Fly
local ToggleFly = Tabs.Main:AddToggle("AutoFly", { Title = "Auto Fly to NPC", Default = false })
_G.AutoFly = false  

ToggleFly:OnChanged(function()
    _G.AutoFly = ToggleFly.Value  
end)

-- üèÉ‚Äç‚ôÇÔ∏è Fix rung camera khi di chuy·ªÉn
function FlyToPosition(targetPosition)
    local character = game.Players.LocalPlayer.Character
    if not character then return end

    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    -- X√≥a c√°c l·ª±c c≈© tr∆∞·ªõc khi th√™m m·ªõi
    for _, obj in ipairs(hrp:GetChildren()) do
        if obj:IsA("BodyVelocity") or obj:IsA("AlignPosition") then
            obj:Destroy()
        end
    end

    -- T·∫°o BodyVelocity ƒë·ªÉ bay m√† kh√¥ng rung
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.Velocity = (targetPosition - hrp.Position).unit * 175 -- ƒêi·ªÅu ch·ªânh t·ªëc ƒë·ªô bay
    bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge) -- Cho ph√©p bay t·ª± do
    bodyVelocity.Parent = hrp

    -- Ch·ªù nh√¢n v·∫≠t ƒë·∫øn n∆°i
    repeat
        task.wait()
    until (hrp.Position - targetPosition).Magnitude < 5

    bodyVelocity:Destroy() -- X√≥a l·ª±c sau khi ƒë·∫øn n∆°i
    hrp.CFrame = CFrame.new(targetPosition) -- ƒê·∫£m b·∫£o kh√¥ng l·ªách v·ªã tr√≠
end

-- üèÜ Nh·∫≠n nhi·ªám v·ª•
function GetQuest()
    if not player.Data or not player.Data:FindFirstChild("Level") then return end

    local level = player.Data.Level.Value  
    local NameQuest, LevelQ, CFQ

    if level >= 1 and level <= 9 then
        NameQuest = "BanditQuest1"
        LevelQ = 1
        CFQ = CFrame.new(1050, 16, 1540)  
    elseif level >= 10 and level <= 14 then
        NameQuest = "JungleQuest"
        LevelQ = 1
        CFQ = CFrame.new(-1600, 36, 150)  
    elseif level >= 15 and level <= 29 then
        NameQuest = "JungleQuest"
        LevelQ = 2
        CFQ = CFrame.new(-1600, 36, 150)  
    elseif level >= 30 and level <= 39 then
        NameQuest = "BuggyQuest1"
        LevelQ = 1
        CFQ = CFrame.new(-1130, 4, 3820)  
    elseif level >= 40 and level <= 59 then
        NameQuest = "BuggyQuest1"
        LevelQ = 2
        CFQ = CFrame.new(-1140.176, 4.752, 3827.405)  
    else
        return
    end

    -- üõë Ki·ªÉm tra n·∫øu ƒë√£ c√≥ nhi·ªám v·ª•
    local questFrame = player.PlayerGui:FindFirstChild("Main") and player.PlayerGui.Main:FindFirstChild("Quest")
    local hasQuest = questFrame and questFrame.Visible

    if not hasQuest then
        -- üöÄ N·∫øu ch∆∞a c√≥ nhi·ªám v·ª•, ki·ªÉm tra Auto Fly c√≥ b·∫≠t kh√¥ng
        if _G.AutoFly then
            FlyToPosition(CFQ.Position)
            task.wait(0.5)  -- ƒê·ª£i m·ªôt ch√∫t tr∆∞·ªõc khi g·ª≠i y√™u c·∫ßu nh·∫≠n nhi·ªám v·ª•
        end

        -- üèÅ Nh·∫≠n l·∫°i nhi·ªám v·ª•
        pcall(function()
            ReplicatedStorage.Remotes.CommF_:InvokeServer("StartQuest", NameQuest, LevelQ)
        end)
    end
end
