local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local questList = {
    [30] = {
        NameQuest = "BuggyQuest1",
        CFQ = CFrame.new(-1141.07495, 4.1000061, 3831.55005),
        LevelQ = 1,
        CFT = {
            CFrame.new(-1160.14258, 18, 3929.40723),
            CFrame.new(-1264.62415, 18, 3903.80957),
            CFrame.new(-943.844299, 30, 3973.2478)
        },
        Ms = "Pirate"
    },
    [40] = {
        NameQuest = "Brute Quest",
        CFQ = CFrame.new(-1141.07495, 4.1000061, 3831.55005),
        LevelQ = 2,
        CFT = {
            CFrame.new(-1204.29492, 20, 4286.92773),
            CFrame.new(-962.269287, 20, 4312.79834),
            CFrame.new(-1333.89319, 20, 4227.29639)
        },
        Ms = "Brute"
    }
}

local function getNearestCFTPosition(mobPos, cftList)
    local nearestPos = nil
    local minDistance = math.huge
    
    for _, CFT in ipairs(cftList) do
        local dist = (Vector3.new(CFT.X, mobPos.Y, CFT.Z) - mobPos).Magnitude
        if dist < minDistance then
            minDistance = dist
            nearestPos = Vector3.new(cft.X, mobPos.Y, cft.Z)
        end
    end
    
    return nearestPos
end

local function moveMobToPosition(mob, targetPos)
    if mob and mob:FindFirstChild("HumanoidRootPart") then
        local rootPart = mob.HumanoidRootPart
        local tweenInfo = TweenInfo.new(1, Enum.EasingStyle.Linear, Enum.EasingDirection.Out)
        local goal = {Position = targetPos}
        local tween = TweenService:Create(rootPart, tweenInfo, goal)
        tween:Play()
    end
end

local function gatherMobs(mobList, scanPosition, mobName)
    for _, mob in ipairs(mobList) do
        if mob and mob:FindFirstChild("HumanoidRootPart") and mob.Name == mobName then
            local rootPart = mob.HumanoidRootPart
            local targetPos = Vector3.new(scanPosition.X, rootPart.Position.Y, scanPosition.Z)
            moveMobToPosition(mob, targetPos)
        end
    end
end

local function moveCharacterThroughCFT(character, cftList, mobList, mobName, height)
    if character and character:FindFirstChild("HumanoidRootPart") then
        local rootPart = character.HumanoidRootPart
        
        local function tweenToPosition(targetPos)
            local goal = {Position = Vector3.new(targetPos.X, height, targetPos.Z)}
            local tweenInfo = TweenInfo.new(1.5, Enum.EasingStyle.Linear, Enum.EasingDirection.Out)
            local tween = TweenService:Create(rootPart, tweenInfo, goal)
            tween:Play()
            tween.Completed:Wait()
        end
        
        for _, cft in ipairs(cftList) do
            tweenToPosition(CFT.Position)
            gatherMobs(mobList, cft.Position, mobName)
        end
    end
end

local function getQuestInfo(lv)
    for level, quest in pairs(questList) do
        if lv >= level and lv < level + 10 then
            return quest
        end
    end
    return nil
end
